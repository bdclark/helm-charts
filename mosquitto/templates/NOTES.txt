ü¶ü Eclipse Mosquitto MQTT Broker has been installed!

üìã CONNECTION INFORMATION:
{{- if contains "LoadBalancer" .Values.service.type }}
   NOTE: It may take a few minutes for the LoadBalancer IP to be available.
   
   Get the external IP address:
   kubectl get svc --namespace {{ .Release.Namespace }} {{ include "mosquitto.fullname" . }}
   
   {{- if .Values.service.ports.mqtt.enabled }}
   MQTT Connection:
   export MQTT_HOST=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "mosquitto.fullname" . }} --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
   mosquitto_pub -h $MQTT_HOST -p {{ .Values.service.ports.mqtt.port }} -t "test/topic" -m "hello world"
   {{- end }}

{{- else if contains "NodePort" .Values.service.type }}
   Get the connection details:
   export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
   {{- if .Values.service.ports.mqtt.enabled }}
   export MQTT_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[?(@.name=='mqtt')].nodePort}" services {{ include "mosquitto.fullname" . }})
   
   MQTT Connection:
   mosquitto_pub -h $NODE_IP -p $MQTT_PORT -t "test/topic" -m "hello world"
   {{- end }}

{{- else if contains "ClusterIP" .Values.service.type }}
   From within the cluster:
   {{- if .Values.service.ports.mqtt.enabled }}
   Host: {{ include "mosquitto.fullname" . }}.{{ .Release.Namespace }}.svc.cluster.local
   Port: {{ .Values.service.ports.mqtt.port }}
   {{- end }}
   
   For external access, use port forwarding:
   {{- if .Values.service.ports.mqtt.enabled }}
   kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "mosquitto.fullname" . }} {{ .Values.service.ports.mqtt.port }}:{{ .Values.service.ports.mqtt.port }}
   
   Then connect to:
   mosquitto_pub -h localhost -p {{ .Values.service.ports.mqtt.port }} -t "test/topic" -m "hello world"
   {{- end }}
{{- end }}

üîå ENABLED SERVICES:
{{- if .Values.service.ports.mqtt.enabled }}
  ‚úì MQTT (Plain):     Port {{ .Values.service.ports.mqtt.port }}
{{- end }}
{{- if .Values.service.ports.mqttTls.enabled }}
  ‚úì MQTT (TLS):       Port {{ .Values.service.ports.mqttTls.port }}
{{- end }}
{{- if .Values.service.ports.websocket.enabled }}
  ‚úì MQTT (WebSocket): Port {{ .Values.service.ports.websocket.port }}
{{- end }}

üîê AUTHENTICATION:
{{- if and .Values.config.allowAnonymous (not .Values.auth.users) }}
  Anonymous connections: ENABLED
  ‚ö†Ô∏è  For production, consider enabling authentication
{{- else if .Values.auth.users }}
  Authentication: ENABLED
  Users configured: {{ len .Values.auth.users }}
  {{- if .Values.auth.acls }}
  ACLs configured: {{ len .Values.auth.acls }}
  {{- end }}
{{- end }}

üíæ PERSISTENCE:
{{- if .Values.persistence.enabled }}
  {{- if .Values.persistence.existingClaim }}
  ‚úì Using existing PVC: {{ .Values.persistence.existingClaim }}
  {{- else }}
  ‚úì PVC created: {{ include "mosquitto.fullname" . }}-data ({{ .Values.persistence.size }})
  {{- end }}
{{- else }}
  ‚ö†Ô∏è  Persistence disabled - messages will be lost on restart
{{- end }}

{{- if and .Values.ingress.enabled .Values.service.ports.websocket.enabled }}

üåê INGRESS:
{{- range $host := .Values.ingress.hosts }}
  {{- range .paths }}
  WebSocket URL: ws{{ if $.Values.ingress.tls }}s{{ end }}://{{ $host.host }}{{ .path }}
  {{- end }}
{{- end }}
{{- end }}

üìö USEFUL COMMANDS:
  # Test MQTT connection
  {{- if and .Values.config.allowAnonymous (not .Values.auth.users) }}
  mosquitto_pub -h <host> -p <port> -t "test/topic" -m "hello"
  mosquitto_sub -h <host> -p <port> -t "test/topic"
  {{- else }}
  mosquitto_pub -h <host> -p <port> -u <username> -P <password> -t "test/topic" -m "hello"
  mosquitto_sub -h <host> -p <port> -u <username> -P <password> -t "test/topic"
  {{- end }}
  
  # View logs
  kubectl logs --namespace {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "mosquitto.name" . }}
  
  # Run connectivity test
  helm test {{ .Release.Name }} --namespace {{ .Release.Namespace }}

üìñ For more information:
  - Chart documentation: See AUTH.md for authentication setup
  - Mosquitto docs: https://mosquitto.org/documentation/
  - GitHub: https://github.com/eclipse/mosquitto